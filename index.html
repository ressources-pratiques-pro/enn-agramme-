<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ennéagramme</title>
  <link rel="stylesheet" href="app.css" />
</head>
<body>
  <header class="top">
    <div class="topLeft">
      <div class="topTitle">Ennéagramme</div>
      <div class="topSub">Clique sur un type pour voir un résumé, puis ouvrir la fiche complète.</div>
    </div>
    <button class="btn small" id="btnReset">Réinitialiser</button>
  </header>
  <main class="layout">
    <section class="panel">
      <svg id="ennea" viewBox="0 0 900 900" role="img" aria-label="Diagramme de l'Ennéagramme">
        <defs>
          <filter id="softGlow" x="-30%" y="-30%" width="160%" height="160%">
            <feGaussianBlur stdDeviation="3" result="blur"/>
            <feMerge>
              <feMergeNode in="blur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
    <circle cx="450" cy="450" r="330" class="ring"/>

    <line x1="450" y1="450" x2="450" y2="160" class="tri"/>
    <line x1="450" y1="450" x2="205" y2="620" class="tri"/>
    <line x1="450" y1="450" x2="695" y2="620" class="tri"/>

    <text x="450" y="350" text-anchor="middle" class="centerLabel inst">Instinctif</text>
    <text x="280" y="610" text-anchor="middle" class="centerLabel men">Mental</text>
    <text x="620" y="610" text-anchor="middle" class="centerLabel emo">Émotionnel</text>

    <path id="hexPath" class="lines" d="M450,160 L670,250 L690,500 L540,705 L360,705 L210,500 L230,250 Z"/>
    <path id="triPath" class="lines" d="M450,160 L205,620 L695,620 Z"/>
    <path id="innerPath" class="lines faint" d="M450,260 C620,300 660,450 610,570 C560,690 420,720 320,660 C220,600 200,460 250,340 C300,220 370,200 450,260 Z"/>

    <g id="nodes" filter="url(#softGlow)">
      <g class="node inst" data-t="9"><circle cx="450" cy="120" r="30"/><text x="450" y="129" text-anchor="middle">9</text></g>
      <g class="node inst" data-t="8"><circle cx="285" cy="165" r="30"/><text x="285" y="174" text-anchor="middle">8</text></g>
      <g class="node inst" data-t="1"><circle cx="615" cy="165" r="30"/><text x="615" y="174" text-anchor="middle">1</text></g>

      <g class="node emo" data-t="2"><circle cx="720" cy="350" r="30"/><text x="720" y="359" text-anchor="middle">2</text></g>
      <g class="node emo" data-t="3"><circle cx="650" cy="560" r="30"/><text x="650" y="569" text-anchor="middle">3</text></g>
      <g class="node emo" data-t="4"><circle cx="510" cy="725" r="30"/><text x="510" y="734" text-anchor="middle">4</text></g>

      <g class="node men" data-t="5"><circle cx="390" cy="725" r="30"/><text x="390" y="734" text-anchor="middle">5</text></g>
      <g class="node men" data-t="6"><circle cx="250" cy="560" r="30"/><text x="250" y="569" text-anchor="middle">6</text></g>
      <g class="node men" data-t="7"><circle cx="180" cy="350" r="30"/><text x="180" y="359" text-anchor="middle">7</text></g>
    </g>

    <line id="lineHealth" class="move health" x1="0" y1="0" x2="0" y2="0" />
    <line id="lineStress" class="move stress" x1="0" y1="0" x2="0" y2="0" />
  </svg>
</section>

<aside class="side" aria-live="polite" style="text-align:left;">
  <div style="display:flex; align-items:baseline; gap:14px; justify-content:flex-start;">
    <div id="uiTypeNum" style="font-size:56px; font-weight:800; letter-spacing:-0.02em; line-height:1;">—</div>
    <div style="min-width:0;">
      <div id="uiTypeName" style="font-size:26px; font-weight:750; line-height:1.2;">Sélectionne un type</div>
      <div id="uiTypeHint" style="margin-top:6px; opacity:.8;">Clique sur un numéro du diagramme pour afficher le profil.</div>
    </div>
  </div>

  <div style="margin-top:18px; display:flex; flex-direction:column; gap:12px; align-items:flex-start;">
    <a id="uiOpenFull" class="btn primary" href="#" aria-disabled="true" style="pointer-events:none; opacity:.6;">Voir la fiche complète</a>
    <a class="btn" href="test-enneagramme-sans-indice.html">Test Ennéagramme</a>
    <button id="uiCloseCard" type="button" class="btn ghost">Explorer l'Ennéagramme</button>
  </div>

  <div id="techCard" style="display:none">
    <div class="badgeRow">
      <div id="badgeNum" class="badge">Type —</div>
    </div>

    <div class="miniGrid">
      <div class="miniCard"><div class="miniTitle">CENTRE D'INTELLIGENCE</div><div id="center" class="miniValue">—</div></div>
      <div class="miniCard"><div class="miniTitle">PEUR DE BASE</div><div id="fear" class="miniValue">—</div></div>
      <div class="miniCard"><div class="miniTitle">DÉSIR DE BASE</div><div id="desire" class="miniValue">—</div></div>
      <div class="miniCard"><div class="miniTitle">COMPULSION (ÉVITEMENT)</div><div id="compulsion" class="miniValue">—</div></div>
    </div>

    <div class="moveCard ok" id="moveHealth">
      <div class="moveTitle">Intégration (santé) &gt; <span id="toIntegr">-</span> :</div>
      <div id="moveHealthText" class="moveText">—</div>
    </div>

    <div class="moveCard warn" id="moveStress">
      <div class="moveTitle">Désintégration (stress) &gt; <span id="toDisint">-</span> :</div>
      <div id="moveStressText" class="moveText">—</div>
    </div>

    <div class="ctaRow">
      <a class="btn" id="openFull" href="type.html" style="pointer-events:none; opacity:.6;">Voir la fiche complète</a>
      <a class="btn primary" id="openProfil" href="profil.html" style="pointer-events:none; opacity:.6;">Niveaux &amp; Profil</a>
    </div>
  </div>
</aside>
  </main>
  <script src="assets/js/app.js?v=99"></script>
  <script>
  (function(){
    const TYPE_LABELS = {
      1: { name: "Le Réformateur" },
      2: { name: "L'Altruiste" },
      3: { name: "Le Battant" },
      4: { name: "Le Romantique" },
      5: { name: "L'Observateur" },
      6: { name: "Le Loyaliste" },
      7: { name: "L'Enthousiaste" },
      8: { name: "Le Leader" },
      9: { name: "Le Médiateur" }
    };

    const badgeNum = document.getElementById("badgeNum");
    const uiNum = document.getElementById("uiTypeNum");
    const uiName = document.getElementById("uiTypeName");
    const uiHint = document.getElementById("uiTypeHint");
    const btnFull = document.getElementById("uiOpenFull");
    const techOpenFull = document.getElementById("openFull");
    const closeBtn = document.getElementById("uiCloseCard");
    const resetBtn = document.getElementById("btnReset");

    function setDisabled(disabled){
      if(!btnFull) return;
      if(disabled){
        btnFull.setAttribute("aria-disabled","true");
        btnFull.style.pointerEvents = "none";
        btnFull.style.opacity = ".6";
        btnFull.href = "#";
      }else{
        btnFull.setAttribute("aria-disabled","false");
        btnFull.style.pointerEvents = "auto";
        btnFull.style.opacity = "1";
      }
    }

    function updateFromType(t){
      const n = Number(t);
      if(!Number.isFinite(n) || n < 1 || n > 9){
        if(uiNum) uiNum.textContent = "—";
        if(uiName) uiName.textContent = "Sélectionne un type";
        if(uiHint) uiHint.textContent = "Clique sur un numéro du diagramme pour afficher le profil.";
        setDisabled(true);
        if(techOpenFull) techOpenFull.href = "type.html";
        return;
      }

      if(uiNum) uiNum.textContent = String(n);
      if(uiName) uiName.textContent = TYPE_LABELS[n]?.name ? TYPE_LABELS[n].name : ("Type " + n);
      if(uiHint) uiHint.textContent = "Ouvre la fiche complète, ou lance le test.";

      const href = "profils/type" + n + ".html";

      if(btnFull){
        btnFull.href = href;
        setDisabled(false);
      }
      if(techOpenFull) techOpenFull.href = href;
    }

    if(closeBtn){
      closeBtn.addEventListener("click", function(){
        if(resetBtn) resetBtn.click();
        else updateFromType(NaN);
      });
    }

    const originalSelect = window.selectType;
    if(typeof originalSelect === "function"){
      window.selectType = function(t){
        originalSelect(t);
        updateFromType(t);
      };
    }

    if(badgeNum){
      const mo = new MutationObserver(function(){
        const txt = badgeNum.textContent || "";
        const m = txt.match(/(\d+)/);
        updateFromType(m ? m[1] : NaN);
      });
      mo.observe(badgeNum, { childList: true, subtree: true, characterData: true });

      const txt = badgeNum.textContent || "";
      const m = txt.match(/(\d+)/);
      updateFromType(m ? m[1] : NaN);
    }else{
      updateFromType(NaN);
    }
  })();
  </script>
</body>
</html>
